## 개요
- 해당 페이지는 JPA SHOP 프로젝트의 기능 약정을 정리한 문서입니다.
- 기능 약정은 사전 조건, 이벤트 흐름, 사후 조건 순으로 작성되었습니다.

---

## 기능 약정

---

### 목차
- [1. 상품](#1-상품)
- [2. 사용자](#2-사용자)
- [3. 장바구니 관리](#3-장바구니-관리)
- [4. 주문](#4-주문)

---


### 기능 약정

---

#### 1. 상품

| 기능                                             | 사전 조건                                      | 이벤트 흐름                                                                                                                                                                                                     | 사후 조건                                   |
|------------------------------------------------|--------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|
| 상품 리스트 조회                                      | 현재 판매하는 상품이 존재한다.                          | 1. 사용자가 상품 리스트 조회 요청을 보낸다.<br><br> 2. 시스템이 데이터베이스에서 현재 판매 중인 상품 정보를 가져온다.<br><br>3. 시스템이 사용자에게 상품 리스트를 반환한다.<br><br>4. 사용자가 반환된 상품 리스트(이름, 가격, 이미지)를 확인한다.<br><br>                                         | 사용자는 현재 판매 중인 상품 리스트를 확인할 수 있다. |
| 상품 리스트 검색                                      | 현재 판매하는 상품이 존재한다.                          | 1. 사용자가 검색어, 가격 범위, 카테고리 등을 입력하여 상품 검색 요청을 보낸다.<br><br>2. 시스템이 입력된 조건에 맞는 상품을 데이터베이스에서 검색한다.<br><br>3. 시스템이 검색 결과를 사용자에게 반환한다.<br><br>4. 사용자가 검색 결과를 확인한다.                                                 | 사용자는 검색 조건에 맞는 상품 리스트를 확인할 수 있다. |
| 카테고리 리스트 조회                                    | 시스템에 카테고리 정보가 존재한다.                        | 1. 사용자가 카테고리 리스트 조회 요청을 보낸다.<br><br>2. 시스템이 데이터베이스에서 카테고리 정보를 가져온다.<br><br>3. 시스템이 사용자에게 카테고리 리스트를 반환한다.<br><br>4. 사용자가 반환된 카테고리 리스트를 확인한다.                                                                | 사용자는 카테고리 리스트를 확인할 수 있다. |
| 상품 상세 조회                                       | 현재 판매하는 상품이 존재한다.                          | 1. 사용자가 특정 상품을 선택하여 상세 정보 조회 요청을 보낸다.<br><br>2. 시스템이 해당 상품의 상세 정보를 데이터베이스에서 가져온다.<br><br>3. 시스템이 사용자에게 상품의 상세 정보를 반환한다.<br><br>4. 사용자가 상품의 상세 정보(이름, 이미지, 상품 설명, 가격 정보, 남은 수량)를 확인한다.                      | 사용자는 특정 상품의 상세 정보를 확인할 수 있다. |

---

#### 2. 사용자

| 기능                | 사전 조건                                           | 이벤트 흐름                                                                                                                                                                                                                                                                                        | 사후 조건                                 | 예외/분기                                                                                                                                                                                       |
|-------------------|-------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 회원가입              | 사용자는 로그인되지 않은 상태여야 한다.                          | 1. 사용자가 회원가입 양식을 작성하여 제출한다.<br><br>2. 시스템이 입력된 정보를 검증한다.<br><br>3. 시스템이 아이디와 이메일 중복 여부를 확인한다.<br><br>4. 중복이 없고 비밀번호 조건이 충족되면 회원 정보를 데이터베이스에 저장한다.<br><br>5. 회원가입 성공 메시지를 사용자에게 반환한다.                                                                                                          | 새로운 사용자 계정이 생성되어 DB에 저장된다.            | 예외 1: 아이디 또는 이메일 정보가 이미 가입되어 있는 유저의 것과 동일하다면 서비스는 회원가입을 거부한다.<br><br>예외 2: 비밀번호는 영문, 숫자, 특수문자를 모두 포함하며, 8자 이상이어야 한다. 이 조건을 만족하지 못한다면 서비스는 회원가입을 거부한다.                                       |
| Kakao, Google 로그인 | 사용자는 카카오 또는 구글 계정을 보유해야 한다.                     | 1. 사용자가 Kakao 또는 Google 로그인 버튼을 클릭한다.<br><br>2. 시스템이 해당 OAuth2 제공자의 인증 페이지로 리디렉션한다.<br><br>3. 사용자가 OAuth2 인증을 완료한다.<br><br>4. 시스템이 OAuth2 제공자로부터 사용자 정보를 받아온다.<br><br>5. 해당 이메일이 이미 존재하는지 확인한다.<br><br>6. 존재하면 계정을 통합하고, 존재하지 않으면 추가 정보(주소 등)를 입력받는다.<br><br>7. 회원 정보를 데이터베이스에 저장하고 로그인 처리한다. | 사용자는 OAuth2를 통해 로그인 및 회원가입을 완료할 수 있다. | 분기 1: 사용자가 처음 OAuth2로 로그인 했으나 이미 해당 이메일이 가입되어 있다면, 두 계정을 통합한다.<br><br>분기 2: 사용자가 처음 OAuth2로 로그인하는 경우 해당 이메일이 존재하지 않는다면, 시스템은 주소 정보를 추가로 입력받아 저장한다.                                          |
| 사용자 정보 조회         | 사용자가 로그인 상태여야 한다.                               | 1. 사용자가 자신의 프로필 조회 요청을 보낸다.<br><br>2. 시스템이 사용자 정보를 데이터베이스에서 가져온다.<br><br>3. 시스템이 사용자에게 사용자 정보(이름, 이메일, 주소, 프로필 이미지)를 반환한다.<br><br>4. 사용자가 반환된 정보를 확인한다.                                                                                                                                       | 사용자는 자신의 프로필 정보를 확인할 수 있다.            |                                                                                                                                                                                             |
| 사용자 정보 수정         | 사용자가 로그인 상태여야 한다.                               | 1. 사용자가 수정할 프로필 정보(이름, 주소, 프로필 이미지)를 입력하고 수정 요청을 보낸다.<br><br>2. 시스템이 입력된 정보를 검증한다.<br><br>3. 시스템이 사용자 정보를 데이터베이스에 업데이트한다.<br><br>4. 시스템이 수정 완료 메시지를 사용자에게 반환한다.                                                                                                                               | 사용자의 프로필 정보가 업데이트된다.                  |                                                                                                                                                                                             |
| 사용자 비밀번호 수정       | 사용자가 로그인 상태여야 한다. 사용자는 ID/PW 기반의 인증방식을 사용해야 한다. | 1. 사용자가 현재 비밀번호와 새로운 비밀번호를 입력하여 비밀번호 수정 요청을 보낸다.<br><br>2. 시스템이 현재 비밀번호를 검증한다.<br><br>3. 새로운 비밀번호가 조건을 만족하는지 검증한다.<br><br>4. 조건이 만족되면 비밀번호를 암호화해 DB에 저장한다.<br><br>5. 수정 완료 메시지를 사용자에게 반환한다.                                                                                                   | 사용자의 비밀번호가 업데이트된다.                    | 예외 1 : 현재 비밀번호가 사용자의 입력 비밀번호와 다르다면 현재 비밀번호가 잘못되었다는 alert를 출력한다. <br><br> 예외 2 : 새로운 비밀번호의 양식이 영문, 숫자, 특수문자를 모두 포함하며, 8자 이상이 아니라면 새 비밀번호가 영문, 숫자, 특수문자를 모두 포함하며, 8자 이상으로 해야한다는 alert창을 출력한다. |
| 가상계좌 추가           | 사용자가 로그인 상태여야 한다.                               | 1. 사용자가 가상 계좌 이름을 입력하여 가상 계좌 추가 요청을 보낸다.<br><br>2. 시스템이 가상 계좌 정보를 생성하여 데이터베이스에 저장한다.<br><br>3. 추가 완료 메시지를 사용자에게 반환한다.                                                                                                                                                                         | 사용자의 가상 계좌가 추가된다.                     |                                                                                                                                                                                             |
| 가상 계좌 리스트 조회      | 사용자가 로그인 상태여야 한다.                               | 1. 사용자가 가상 계좌 리스트 조회 요청을 보낸다.<br><br>2. 시스템이 사용자 가상 계좌 정보를 데이터베이스에서 가져온다.<br><br>3. 시스템이 가상 계좌 리스트를 사용자에게 반환한다.<br><br>4. 사용자가 반환된 가상 계좌 리스트를 확인한다.                                                                                                                                           | 사용자는 자신의 가상 계좌 리스트를 확인할 수 있다.         |                                                                                                                                                                                             |
| 계좌 금액 추가          | 사용자가 로그인 상태여야 하며, 금액을 추가하려는 계좌가 본인 소유여야 한다.     | 1. 사용자가 충전할 금액을 입력하여 가상 계좌 충전 요청을 보낸다.<br><br>2. 시스템이 충전할 금액을 검증한다.<br><br>3. 시스템이 추가된 금액을 DB에 반영한다.<br><br>4. 충전 완료 메시지를 사용자에게 반환한다.                                                                       | 사용자의 가상 계좌에 금액이 충전된다.                 |       사용자의 충전 금액이 최대 범위(약 21억)을 넘어간 경우 실패 alert를 출력한다.                                                    

---

#### 3. 장바구니 관리

아래는 올바르게 고쳐진 테이블입니다.

| 기능                | 사전 조건                                           | 이벤트 흐름                                                                                                                                                                                                                                                                                        | 사후 조건                                 | 예외/분기                                                                             |
|------------|---------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|-----------------------------------------------------------------------------------|
| 장바구니 추가    | 사용자가 로그인 상태여야 한다.   | 1. 사용자가 특정 상품과 갯수를 선택하여 장바구니에 담기 요청을 보낸다.<br><br>2. 시스템이 장바구니에 해당 상품과 갯수를 추가한다.<br><br>3. 추가 완료 메시지를 사용자에게 반환한다.                                                                                  | 사용자의 장바구니에 선택한 상품이 추가된다.  |                                                                                   |
| 장바구니 갯수 조절 | 사용자가 로그인 상태여야 하며, 장바구니에 상품이 담겨 있어야 한다. | 1. 사용자가 장바구니 리스트에서 특정 상품의 갯수를 변경하여 수정 요청을 보낸다.<br><br>2. 시스템이 장바구니에 해당 상품의 갯수를 업데이트한다.<br><br>3. 수정 완료 메시지를 사용자에게 반환한다.                                                                     | 사용자의 장바구니에 담긴 상품의 갯수가 업데이트된다. | 분기 1 : 상품을 0개 이하로 줄이고자 하는 경우 "상품을 제거하시겠습니까?"라는 alert창을 띄우고 "네"를 클릭할 시 장바구니를 제거한다. |
---

#### 4. 주문

| 기능                                                                      | 사전 조건                                               | 이벤트 흐름                                                                                                                                                       | 사후 조건                                            | 예외/분기                                                                                                                                                                         |
|-------------------------------------------------------------------------|-----------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 주문 요청                                                                   | 사용자가 로그인 상태여야 한다.                                   | 1. 사용자가 장바구니 또는 상품 정보 페이지에서 주문 요청을 보낸다.<br><br>2. 시스템이 주문할 상품의 정보를 확인한다.<br><br>3. 시스템은 주문하기 전 사용자가 주문하려는 상품의 리스트, 각 상품의 갯수, 각 상품 당 가격, 총 결제 금액을 사용자에게 제공한다. | 사용자는 결제 페이지로 이동할 수 있다.                           |                                                                                                                                                                                         |
| 결제                                                                      | 사용자가 결제 페이지에 있어야 한다.                                | 1. 사용자가 결제하기 버튼을 클릭한다.<br><br>2. 시스템이 사용자의 가상 계좌 잔액을 확인한다.<br><br>3. 재고가 충분한지 확인한다.<br><br>4. 잔액이 충분하고 재고가 있으면 결제를 진행한다.<br><br>5. 결제 완료 메시지를 사용자에게 반환한다.    | 주문이 완료되고 계좌의 금액이 차감되고, 재고가 주문 갯수만큼 감소해 DB에 반영된다. | 제약사항 1: 사용자의 상품 중 재고가 모자란 상품이 있다면 주문에 실패한다.<br><br>제약사항 2: 사용자의 잔액이 총 결제 금액보다 적다면 주문에 실패한다.                                                                            |
| 주문 취소                                                                   | 주문이 완료된 상태여야 한다.<br><br> 로그인된 사용자가 실제 주문한 사람이여야 한다. | 1. 사용자가 결제 취소 요청을 보낸다.<br><br>2. 시스템이 취소 요청을 확인하고 처리한다.<br><br>3. 금액이 사용자의 가상 계좌로 환불된다.<br><br>4. 취소 완료 메시지를 사용자에게 반환한다.                                     | 사용자의 가상 계좌에 환불 금액이 입금되고, 주문이 취소된다.               |                                                                                                                                                                                         |
| 주문내역 조회  | 사용자가 로그인 상태여야 한다.                                   | 1. 사용자가 주문내역 조회 요청을 보낸다.<br><br>2. 시스템이 사용자 주문내역을 데이터베이스에서 가져온다.<br><br>3. 시스템이 주문내역(주문 상품, 각 상품의 갯수, 각 상품 당 가격, 총 결제 금액, 결제 일자 정보)을 사용자에게 반환한다.<br><br>4. 사용자가 주문내역을 확인한다.                               | 사용자는 자신의 주문내역(주문 상품, 각 상품의 갯수, 각 상품 당 가격, 총 결제 금액, 결제 일자 정보)을 확인할 수 있다.                       |                                                                                                                                                                                         |

---
